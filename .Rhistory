set.seed(201613424)
# Eliminar aleatoriamente el 10% de la base
# Número exacto de filas a eliminar (10% de la base)
eliminar <- round(0.1 * nrow(data))
# Escoger aleatoriamente los índices a eliminar
drop_index <- sample(1:nrow(data), size = eliminar)
# Crear la submuestra eliminando esos índices
data_final <- data[-drop_index, ]
# Solo municipios costeros que reciben petroleo
data_final <- subset(data_final, coastal == 1 & onshore == 0)
# Observa base
str(data_final)
#Transformación de variables
data_final <- data_final %>%
rename(
revenue     = mun_budget_revenue2000_pred_c,
oil_pc      = oilandgasvalue2000_cap,
lat         = latitude1998,
lon         = longitude1998,
coast       = coastal,
dist_fedcap = dist_federal_capital1998,
dist_statecap = dist_state_capital1998,
state_cap   = state_capital,
state    = sigla,
)
# Cambiar a tipo factor
data_final <- data_final %>% mutate(state = as.factor(state))
# Primera etapa con FE de estado
prim_et <- lm(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state),
data = data_final
)
#Resultados por cluster
vc <- vcovCL(prim_et, cluster = ~ state, type = "HC1")
ct <- coeftest(prim_et, vcov = vc)
# Solo coeficientes a reportar y sus SE
vars_keep <- c("oil_pc","lat","lon","coast","dist_fedcap","dist_statecap","state_cap")
idx <- match(vars_keep, rownames(ct))
betas <- ct[idx, "Estimate"]
ses   <- ct[idx, "Std. Error"]
#Tabulación de los resultados
stargazer(
prim_et,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse = "|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo",
"Latitud",
"Longitud",
"Dummy costa",
"Dist. capital federal",
"Dist. capital estatal",
"Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10, .05, .01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles",
notes            = "Errores estándar robustos agrupados por estado entre paréntesis.",
font.size        = "scriptsize",
table.align      = "center"
)
#Tabulación de los resultados
stargazer(
prim_et,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse = "|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo",
"Latitud",
"Longitud",
"Dummy costa",
"Dist. capital federal",
"Dist. capital estatal",
"Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10, .05, .01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles",
notes            = "Errores estándar robustos agrupados por estado entre paréntesis.",
table.align      = "center"
)
# Eliminar aleatoriamente el 10% de la base
# Número exacto de filas a eliminar (10% de la base)
eliminar <- round(0.1 * nrow(data))
# Escoger aleatoriamente los índices a eliminar
drop_index <- sample(1:nrow(data), size = eliminar)
# Crear la submuestra eliminando esos índices
data_final <- data[-drop_index, ]
# Solo municipios costeros que reciben petroleo
data_final <- subset(data_final, coastal == 1 & onshore == 0)
# Observa base
str(data_final)
#Transformación de variables
data_final <- data_final %>%
rename(
revenue     = mun_budget_revenue2000_pred_c,
oil_pc      = oilandgasvalue2000_cap,
lat         = latitude1998,
lon         = longitude1998,
coast       = coastal,
dist_fedcap = dist_federal_capital1998,
dist_statecap = dist_state_capital1998,
state_cap   = state_capital,
state    = sigla,
)
# Cambiar a tipo factor
data_final <- data_final %>% mutate(state = as.factor(state))
# Primera etapa con FE de estado
prim_et <- lm(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state),
data = data_final
)
#Resultados por cluster
vc <- vcovCL(prim_et, cluster = ~ state, type = "HC1")
ct <- coeftest(prim_et, vcov = vc)
# Solo coeficientes a reportar y sus SE
vars_keep <- c("oil_pc","lat","lon","coast","dist_fedcap","dist_statecap","state_cap")
idx <- match(vars_keep, rownames(ct))
betas <- ct[idx, "Estimate"]
ses   <- ct[idx, "Std. Error"]
#Tabulación de los resultados
stargazer(
prim_et,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse = "|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo",
"Latitud",
"Longitud",
"Dummy costa",
"Dist. capital federal",
"Dist. capital estatal",
"Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10, .05, .01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles",
notes            = "Errores estándar robustos agrupados por estado entre paréntesis.",
table.align      = "center"
)
#Presentación de resultados en tabla
stargazer(
m_edu_iv, m_salud_iv, m_trans_iv, m_soc_iv,
type = "latex",
se = list(ses),
dep.var.labels = c("Gasto Educación/Cultura",
"Gasto Salud/Saneamiento",
"Gasto Transporte",
"Gasto Asistencia Social"),
covariate.labels = c("Ingresos (IV)",
"Latitud",
"Longitud",
"Costa",
"Dist. capital federal",
"Dist. capital estatal",
"Capital estatal"),
omit = "factor\\(state\\)|\\(Intercept\\)",
omit.labels = "Dummies de estado",
star.cutoffs = c(.10, .05, .01),
digits = 3,
title = "Segunda etapa: ingresos instrumentados y gastos por función",
notes = "Errores estándar robustos agrupados por estado entre paréntesis.",
font.size = "scriptsize",
table.align = "center"
)
data_final <- data_final %>%
rename(
amc_code        = new_code_1970_1997,
per_ho_elec     = prc_hhld_with_power_2000,
salon_pob_2005  = clroomsMunicipal_pop2005,
clinic_pob_2002 = estab_mun2002_without_pop,
km_pob_2005     = km_paved_munic_c,
ex_edu_cult        = pmun_exp_funct_educ_cult2000c,
ex_salud_sani      = pmun_exp_funct_health_sanit2000c,
ex_desarrollo_urb  = pmun_exp_funct_hous_urban2000c,
ex_transp          = pmun_exp_funct_transport2000c,
ex_soc_transf      = pmun_exp_funct_welf2000c,
perc_nofavelas     = p_hhld_abovestrandard_ppl_2000
)
#Agrupación de variables de interés
outcomes <- c(
"ex_edu_cult",
"ex_salud_sani",
"ex_desarrollo_urb",
"ex_transp", "
ex_soc_transf"
)
data_final$state <- as.factor(data_final$state)
#Estimación de la segunda etapa para cada una de las variables de resultado
m_edu_iv <- ivreg(ex_edu_cult ~ revenue + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state) | oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state), data = data_final)
m_salud_iv <- ivreg(ex_salud_sani ~ revenue + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state) |oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state), data = data_final)
m_urb_iv  <- ivreg(ex_desarrollo_urb ~ revenue + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state) |oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state), data = data_final)
m_trans_iv <- ivreg(ex_transp ~ revenue + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state) |oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state), data = data_final)
m_soc_iv   <- ivreg(ex_soc_transf     ~ revenue + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state) |oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state), data = data_final)
#Errores agrupados por Estado
vc <- function(m) sandwich::vcovCL(m, cluster = ~ state, type = "HC1")
ses <- lapply(list(m_edu_iv,m_salud_iv,m_urb_iv,m_trans_iv,m_soc_iv), function(m) sqrt(diag(vc(m))))
#Presentación de resultados en tabla
stargazer(
m_edu_iv, m_salud_iv, m_trans_iv, m_soc_iv,
type = "latex",
se = list(ses),
dep.var.labels = c("Gasto Educación/Cultura",
"Gasto Salud/Saneamiento",
"Gasto Transporte",
"Gasto Asistencia Social"),
covariate.labels = c("Ingresos (IV)",
"Latitud",
"Longitud",
"Costa",
"Dist. capital federal",
"Dist. capital estatal",
"Capital estatal"),
omit = "factor\\(state\\)|\\(Intercept\\)",
omit.labels = "Dummies de estado",
star.cutoffs = c(.10, .05, .01),
digits = 3,
title = "Segunda etapa: ingresos instrumentados y gastos por función",
notes = "Errores estándar robustos agrupados por estado entre paréntesis.",
font.size = "scriptsize",
table.align = "center"
)
#Presentación de resultados en tabla
stargazer(
m_edu_iv, m_salud_iv, m_trans_iv, m_soc_iv,
type = "latex",
se = list(ses),
dep.var.labels = c("Gasto Educación/Cultura",
"Gasto Salud/Saneamiento",
"Gasto Transporte",
"Gasto Asistencia Social"),
covariate.labels = c("Ingresos (IV)",
"Latitud",
"Longitud",
"Costa",
"Dist. capital federal",
"Dist. capital estatal",
"Capital estatal"),
omit = "factor\\(state\\)|\\(Intercept\\)",
omit.labels = "Dummies de estado",
star.cutoffs = c(.10, .05, .01),
digits = 3,
title = "Segunda etapa: ingresos instrumentados y gastos por función",
notes = "Errores estándar robustos agrupados por estado entre paréntesis.",
font.size = "scriptsize",
table.align = "center"
)
#Tabulación de los resultados
stargazer(
prim_et,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse = "|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo",
"Latitud",
"Longitud",
"Dummy costa",
"Dist. capital federal",
"Dist. capital estatal",
"Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10, .05, .01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles",
notes            = "Errores estándar robustos agrupados por estado entre paréntesis."
)
# Solo coeficientes a reportar y sus SE
vars_keep <- c("oil_pc","lat","lon","coast","dist_fedcap","dist_statecap","state_cap")
idx <- match(vars_keep, rownames(ct))
betas <- ct[idx, "Estimate"]
ses   <- ct[idx, "Std. Error"]
#Tabulación de los resultados
stargazer(
prim_et,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse = "|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo",
"Latitud",
"Longitud",
"Dummy costa",
"Dist. capital federal",
"Dist. capital estatal",
"Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10, .05, .01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles",
notes            = "Errores estándar robustos agrupados por estado entre paréntesis."
)
#Tabulación de los resultados
stargazer(
prim_et,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse = "|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo",
"Latitud",
"Longitud",
"Dummy costa",
"Dist. capital federal",
"Dist. capital estatal",
"Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10, .05, .01),
digits           = 3,
title            = "Ingresos municipales sobre producción petrolera y controles",
)
#Tabulación de los resultados
stargazer(
prim_et,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse = "|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo",
"Latitud",
"Longitud",
"Dummy costa",
"Dist. capital federal",
"Dist. capital estatal",
"Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10, .05, .01),
digits           = 3,
title            = "Ingresos municipales sobre producción petrolera y controles"
)
#Presentación de resultados en tabla
stargazer(
m_edu_iv, m_salud_iv, m_trans_iv, m_soc_iv,
type = "latex",
se = list(ses),
dep.var.labels = c("Gasto Educación/Cultura",
"Gasto Salud/Saneamiento",
"Gasto Transporte",
"Gasto Asistencia Social"),
covariate.labels = c("Ingresos (IV)",
"Latitud",
"Longitud",
"Costa",
"Dist. capital federal",
"Dist. capital estatal",
"Capital estatal"),
omit = "factor\\(state\\)|\\(Intercept\\)",
omit.labels = "Dummies de estado",
star.cutoffs = c(.10, .05, .01),
digits = 3,
title = "Segunda etapa: ingresos instrumentados y gastos por función"
)
#Presentación de resultados en tabla
stargazer(
m_edu_iv, m_salud_iv, m_trans_iv, m_soc_iv,
type = "text",
se = list(ses),
dep.var.labels = c("Gasto Educación/Cultura",
"Gasto Salud/Saneamiento",
"Gasto Transporte",
"Gasto Asistencia Social"),
covariate.labels = c("Ingresos (IV)",
"Latitud",
"Longitud",
"Costa",
"Dist. capital federal",
"Dist. capital estatal",
"Capital estatal"),
omit = "factor\\(state\\)|\\(Intercept\\)",
omit.labels = "Dummies de estado",
star.cutoffs = c(.10, .05, .01),
digits = 3,
title = "Segunda etapa: ingresos instrumentados y gastos por función"
)
#Tabulación forma reducida
stargazer(
m_nofav, m_classrooms,
type             = "text",
se               = list(se_nofav, se_classrooms),
dep.var.labels   = c("No-favelas", "Salones por millón de habitantes"),
covariate.labels = c("Producción de petróleo per cápita"),
keep             = "^oil_pc$",
omit             = "factor\\(state_id\\)|lat|lon|coast|dist_fedcap|dist_statecap|state_cap|Intercept",
omit.labels      = "Controles y efectos fijos",
star.cutoffs     = c(.10,.05,.01),
table.align = "center",
digits           = 3,
title            = "Efecto del petróleo sobre indicadores de bienestar"
)
# Personas que no viven en favelas en 2000
m_nofav <- lm(perc_nofavelas ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state), data = data_final)
# Número de salones por millón de habitantes en el 2005.
m_classrooms <- lm(salon_pob_2005 ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state), data = data_final)
# Errores estándar robustos agrupados por estado
se_nofav      <- sqrt(diag(vcovCL(m_nofav, cluster = ~ state, type = "HC1")))
se_classrooms <- sqrt(diag(vcovCL(m_classrooms, cluster = ~ state, type = "HC1")))
#Tabulación forma reducida
stargazer(
m_nofav, m_classrooms,
type             = "text",
se               = list(se_nofav, se_classrooms),
dep.var.labels   = c("No-favelas", "Salones por millón de habitantes"),
covariate.labels = c("Producción de petróleo per cápita"),
keep             = "^oil_pc$",
omit             = "factor\\(state_id\\)|lat|lon|coast|dist_fedcap|dist_statecap|state_cap|Intercept",
omit.labels      = "Controles y efectos fijos",
star.cutoffs     = c(.10,.05,.01),
table.align = "center",
digits           = 3,
title            = "Efecto del petróleo sobre indicadores de bienestar"
)
str(ses)
list(ses)
str(ses)
v
str(ses)
#Errores agrupados por Estado
vc <- function(m) sandwich::vcovCL(m, cluster = ~ state, type = "HC1")
ses2 <- lapply(list(m_edu_iv,m_salud_iv,m_trans_iv,m_soc_iv), function(m) sqrt(diag(vc(m))))
#Presentación de resultados en tabla
stargazer(
m_edu_iv, m_salud_iv, m_trans_iv, m_soc_iv,
type = "text",
se = ses2,
dep.var.labels = c("Gasto Educación/Cultura",
"Gasto Salud/Saneamiento",
"Gasto Transporte",
"Gasto Asistencia Social"),
covariate.labels = c("Ingresos (IV)",
"Latitud",
"Longitud",
"Costa",
"Dist. capital federal",
"Dist. capital estatal",
"Capital estatal"),
omit = "factor\\(state\\)|\\(Intercept\\)",
omit.labels = "Dummies de estado",
star.cutoffs = c(.10, .05, .01),
digits = 3,
title = "Segunda etapa: ingresos instrumentados y gastos por función"
)
#Tabulación forma reducida
stargazer(
m_nofav, m_classrooms,
type             = "text",
se               = list(se_nofav, se_classrooms),
dep.var.labels   = c("No-favelas", "Salones por millón de habitantes"),
covariate.labels = c("Producción de petróleo per cápita"),
keep             = "^oil_pc$",
omit             = "factor\\(state_id\\)|lat|lon|coast|dist_fedcap|dist_statecap|state_cap|Intercept",
omit.labels      = "Controles y efectos fijos",
star.cutoffs     = c(.10,.05,.01),
digits           = 3,
title            = "Efecto del petróleo sobre indicadores de bienestar"
)
#Presentación de resultados en tabla
stargazer(
m_edu_iv, m_salud_iv, m_trans_iv, m_soc_iv,
type = "text",
se = ses2,
dep.var.labels = c("Educación/Cultura",
"Salud/Saneamiento",
"Transporte",
"Asistencia Social"),
covariate.labels = c("Ingresos (IV)",
"Latitud",
"Longitud",
"Costa",
"Dist. capital federal",
"Dist. capital estatal",
"Capital estatal"),
omit = "factor\\(state\\)|\\(Intercept\\)",
omit.labels = "Dummies de estado",
star.cutoffs = c(.10, .05, .01),
digits = 3,
title = "Segunda etapa: ingresos instrumentados y gastos por función"
)
# Cargar liberias y paquetes
#install.packages("haven")
#install.packages("plm")
#install.packages("skimr")
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("modelsummary")
library(knitr)
library(haven)
library(plm)
library(scales)
library(skimr)
library(dplyr)
library(ggplot2)
library(AER)
library(fixest)
library(lmtest)
library(sandwich)
library(tidyverse)
library(stargazer)
# Leer archivo .dta
data <- read_dta("oil_windfall_sin10perc.dta")
set.seed(201613424)
```{=latex}
tinytex::is_tinytex()
