install.packages("haven") # Archivos .dta
install.packages("haven") # Archivos .dta
install.packages("plm")
install.packages("skimr")
install.packages("skimr")
install.packages("dplyr")
install.packages("ggplot2")
install.packages("skimr")
install.packages("skimr")
# Leer archivo .dta
data <- read_dta("oil_windfall_sin10perc.dta")
library(haven)
library(haven)
library(plm)
library(haven)
library(plm)
library(scales)
library(skimr)
library(haven)
library(plm)
library(scales)
library(skimr)
library(dplyr)
library(ggplot2)
# Leer archivo .dta
data <- read_dta("oil_windfall_sin10perc.dta")
getwd()
list.files()
file.exists("oil_windfall_sin10perc.dta")
# Leer archivo .dta
data <- read_dta("oil_windfall_sin10perc.dta")
# Leer archivo .dta
data <- read_dta("oil_windfall_sin10perc.dta")
View(data)
set.seed(201613424)
<<<<<<< HEAD
library(fixest)
library(modelsummary)
install.packages("modelsummary")
#Transformación de variables
data <- data %>%
rename(
revenue     = mun_budget_revenue2000_pred_c,
oil_pc      = oilandgasvalue2000_cap,
lat         = latitude1998,
lon         = longitude1998,
coast       = coastal,
dist_fedcap = dist_federal_capital1998,
dist_statecap = dist_state_capital1998,
state_cap   = state_capital,
state_id    = state
)
library(tidyverse)
#Transformación de variables
data <- data %>%
rename(
revenue     = mun_budget_revenue2000_pred_c,
oil_pc      = oilandgasvalue2000_cap,
lat         = latitude1998,
lon         = longitude1998,
coast       = coastal,
dist_fedcap = dist_federal_capital1998,
dist_statecap = dist_state_capital1998,
state_cap   = state_capital,
state_id    = state
)
#Transformación de variables
data <- data %>%
rename(
revenue     = mun_budget_revenue2000_pred_c,
oil_pc      = oilandgasvalue2000_cap,
lat         = latitude1998,
lon         = longitude1998,
coast       = coastal,
dist_fedcap = dist_federal_capital1998,
dist_statecap = dist_state_capital1998,
state_cap   = state_capital,
sigla    = state
)
#Transformación de variables
data <- data %>%
rename(
revenue     = mun_budget_revenue2000_pred_c,
oil_pc      = oilandgasvalue2000_cap,
lat         = latitude1998,
lon         = longitude1998,
coast       = coastal,
dist_fedcap = dist_federal_capital1998,
dist_statecap = dist_state_capital1998,
state_cap   = state_capital,
state    = sigla
)
primera <- feols(
revenues ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap | state_id,
data = df,
cluster = ~ state_id
)
primera <- feols(
revenues ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap | state_id,
data = data,
cluster = ~ state_id
)
primera <- feols(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap | state_id,
data = data,
cluster = ~ state_id
)
primera <- feols(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap | state,
data = data,
cluster = ~ state_id
)
#Transformación de variables
data <- data %>%
rename(
revenue     = mun_budget_revenue2000_pred_c,
oil_pc      = oilandgasvalue2000_cap,
lat         = latitude1998,
lon         = longitude1998,
coast       = coastal,
dist_fedcap = dist_federal_capital1998,
dist_statecap = dist_state_capital1998,
state_cap   = state_capital,
state    = sigla
)
primera <- feols(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap | state,
data = data,
cluster = ~ state
)
prmr <- feols(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap | state,
data = data,
cluster = ~ state
)
segnd <- feols(
outcome ~ 1 | state | (revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap),
data = data,
cluster = ~ state
)
# F de relevancia del instrumento (test de Wald para 'oil_pc = 0')
wald_q  <- wald(prmr, "oil_pc = 0")
F_inst  <- tryCatch(as.numeric(wald_q$stat),    error = function(e) NA_real_)
p_inst  <- tryCatch(as.numeric(wald_q$p.value), error = function(e) NA_real_)
# Etiquetas
vlabels <- c(
"oil_pc"        = "Oil output per capita (Q_m)",
"lat"           = "Latitude",
"lon"           = "Longitude",
"coast"         = "Coastal dummy",
"dist_fedcap"   = "Distance to federal capital",
"dist_statecap" = "Distance to state capital",
"state_cap"     = "State-capital dummy"
)
# Etiquetas
vlabels <- c(
"oil_pc"        = "Producción de petróleo per cápita (Q_m)",
"lat"           = "Latitud",
"lon"           = "Longitud",
"coast"         = "Dummy de costa",
"dist_fedcap"   = "Distancia a la capital federal",
"dist_statecap" = "Distancia a la capital estatal",
"state_cap"     = "Dummy capital estatal"
)
#Notas al pie
notas <- paste0(
"Primera etapa en niveles con efectos fijos y errores estándar agrupados por Estado",
"Relevancia del instrumento: F = ", sprintf("%.2f", F_inst),
", p-value = ", ifelse(is.na(p_inst), "NA", sprintf("%.3f", p_inst)), "."
)
#Estadísticos
gof_map <- tribble(
~raw,                ~clean,               ~fmt,   ~omit,
"nobs",              "N. Obs",       0,      FALSE,
"r.squared",         "R-2",          3,      FALSE,
"r2_within",         "Within R-squared",   3,      FALSE
)
modelsummary(
list("Primera etapa (niveles)" = prmr),
coef_map   = vlabels,
statistic  = "({std.error})",
stars      = c('*'=.10, '**'=.05, '***'=.01),
gof_map    = gof_map,
gof_omit   = "IC|Log|Std.Errors|AIC|BIC",
add_rows   = data.frame(
term = c("Efectos fijos: Estado", "ES agrupado: Estado"),
`Primera etapa (niveles)` = c("Sí", "Sí")
),
notes      = notas,
output     = "markdown",
title      = "Primera etapa: Ingresos municipales sobre producción petrolera y controles geográficos"
)
library(modelsummary)
modelsummary(
list("Primera etapa (niveles)" = prmr),
coef_map   = vlabels,
statistic  = "({std.error})",
stars      = c('*'=.10, '**'=.05, '***'=.01),
gof_map    = gof_map,
gof_omit   = "IC|Log|Std.Errors|AIC|BIC",
add_rows   = data.frame(
term = c("Efectos fijos: Estado", "ES agrupado: Estado"),
`Primera etapa (niveles)` = c("Sí", "Sí")
),
notes      = notas,
output     = "markdown",
title      = "Primera etapa: Ingresos municipales sobre producción petrolera y controles geográficos"
)
library(stargazer)
# Cambiar a tipo factor
data <- data %>% mutate(state = as.factor(state))
# Primera etapa con FE de estado
m_first_lm <- lm(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state),
data = data
)
rm(prmr)
rm(notas)
rm(wald_q)
rm(p_inst)
rm(F_inst)
rm(vlabels)
rm(m_first_lm)
rm(gof_map)
rm(primera)
# Primera etapa con FE de estado
primer <- lm(
revenue ~ oil_pc + lat + lon + coast + dist_fedcap + dist_statecap + state_cap + factor(state),
data = data
)
#Asegurar la relevancia del estadístico en la primera etapa
vcov_cl <- vcovCL(primer, cluster = ~ state, type = "HC1")
library(lmtest)
library(sandwich)
#Asegurar la relevancia del estadístico en la primera etapa
vcov_cl <- vcovCL(primer, cluster = ~ state, type = "HC1")
se_cl   <- sqrt(diag(vcov_cl))
ct_oil  <- coeftest(primer, vcov = vcov_cl)["oil_pc", , drop = FALSE]
t_oil   <- as.numeric(ct_oil[1, "t value"])
F_inst  <- t_oil^2
#Etiquetas
cov_labels <- c(
"Producción de petróleo per cápita (Q_m)",
"Latitud",
"Longitud",
"Dummy de costa",
"Distancia a la capital federal",
"Distancia a la capital estatal",
"Dummy capital estatal"
)
lineas_extra <- list(
c("Efectos fijos: Estado", "Sí"),
c("Errores agrupados: Estado", "Sí"),
c("Estadístico F del instrumento (oil_pc)", sprintf("%.2f", F_inst))
)
stargazer(
primer,
type              = "html",
se                = list(se_cl),
dep.var.labels    = "Ingresos municipales (PIB)",
covariate.labels  = cov_labels,
omit              = "factor\\(state_id\\)",
omit.labels       = "Dummies de estado",
omit.stat         = c("ser","f"),
star.cutoffs      = c(0.10, 0.05, 0.01),
title             = "Primera etapa: Ingresos municipales sobre producción petrolera y controles geográficos",
add.lines         = lineas_extra,
notes             = "Errores estándar robustos agrupados por estado entre paréntesis.",
notes.align       = "l",
digits            = 3
)
vc <- vcovCL(primer, cluster = ~ state, type = "HC1")
ct <- coeftest(primer, vcov = vc)
# Solo coeficientes a reportar y sus SE
vars_keep <- c("oil_pc","lat","lon","coast","dist_fedcap","dist_statecap","state_cap")
idx <- match(vars_keep, rownames(ct))
betas <- ct[idx, "Estimate"]
ses   <- ct[idx, "Std. Error"]
stargazer(
m_first,
type = "html",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse="|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo","Latitud","Longitud",
"Dummy costa","Dist. capital federal","Dist. capital estatal","Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10,.05,.01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles"
)
stargazer(
primer,
type = "html",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse="|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo","Latitud","Longitud",
"Dummy costa","Dist. capital federal","Dist. capital estatal","Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10,.05,.01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles"
)
stargazer(
primer,
type = "text",
coef = list(betas),
se   = list(ses),
keep = paste0("^(", paste(vars_keep, collapse="|"), ")$"),
dep.var.labels   = "Ingresos municipales",
covariate.labels = c("Producción de petróleo","Latitud","Longitud",
"Dummy costa","Dist. capital federal","Dist. capital estatal","Dummy capital estatal"),
omit             = "factor\\(state_id\\)|\\(Intercept\\)",
star.cutoffs     = c(.10,.05,.01),
digits           = 3,
title            = "Primera etapa: ingresos municipales sobre producción petrolera y controles"
)
=======
# Cargar liberias y paquetes
install.packages("haven") # Archivos .dta
install.packages("plm")
install.packages("skimr")
install.packages("dplyr")
install.packages("ggplot2")
library(haven)
library(plm)
library(scales)
library(skimr)
library(dplyr)
library(ggplot2)
# Leer archivo .dta
data <- read_dta("oil_windfall_sin10perc.dta")
set.seed(201613424)
install.packages("skimr")
>>>>>>> 8a9a52dfa22dcc47510345e6d89a5ef7d7d6d680
